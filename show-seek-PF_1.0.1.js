var productSearchResults,searchCustomers,searchCounter,searchResults,funcMonth,funcDate,funcYear,product,search,storeId="73177391",key="secret_bQZqubGJryLCVhPgf6yEEjvnasrQqz7u",checked=0;const months=["January","February","March","April","May","June","July","August","September","October","November","December"],d=new Date;let todayMonth=months[d.getMonth()];function showSearch(g,h,i,j){$('[show="heading"]').text("Searching..."),$('[party="heading"]').text("Searching...");var c=[],l=(h+"/"+i+"/"+j).toUpperCase();for(let f=0;f<g.items.length;f++){var k=g.items[f].sku.replace(/\s/g,""),m=k.split(",")[0].replace(/\D/g,""),n=k.split(",")[0].replace(/[0-9]/g,"").toUpperCase(),o=k.split("-")[0].split(",")[1],p=(n+"/"+m+"/"+o).toUpperCase();l===p&&c.push(g.items[f])}var b=[];if($('[show="list"]').empty(),$('[party="list"]').empty(),0===c.length)$('[show="heading"]').text("No Shows On "+h+" "+i+", "+j),$('[party="heading"]').text("Make New Search");else if(c.length>0){for(let e=0;e<c.length;e++){searchOrders(c[e].id);let q={name:c[e].name,id:c[e].id,month:c[e].sku.replace(/\s/g,"").split(",")[0].replace(/[0-9]/g,"").toUpperCase(),day:c[e].sku.replace(/\s/g,"").split(",")[0].replace(/\D/g,""),year:c[e].sku.replace(/\s/g,"").split("-")[0].split(",")[1],time:c[e].sku.replace(/\s/g,"").split("-")[1].toUpperCase(),remaining:c[e].quantity,purchased:searchCounter,customers:searchCustomers};b.push(q)}for(let a=0;a<b.length;a++){var r=`<div id="show-div" ct="${a}" class="show-div"> <h2 show="title" class="show-heading">${b[a].name}</h2> <div class="show-time-div"> <div class="date-container"> <div show="month" class="show-date">${b[a].month}</div><div show="day" class="show-date">${b[a].day}</div><div class="show-date">,</div><div show="year" class="show-date">${b[a].year}</div></div><div class="show-time">${b[a].time}</div></div><div class="show-time-info-div"></div><div class="info-wrapper"> <div class="info-div"> <div class="info-container"> <div class="info-text">Tickets Available: </div><div show="available" class="info-text">${b[a].remaining}</div></div><div class="info-container"> <div class="info-text">Tickets Purchased:</div><div show="purchased" class="info-text">${b[a].purchased}</div></div><div class="info-container"> <div class="info-text">Initial Total:</div><div show="first-stock" class="info-text">${parseInt(b[a].purchased)+parseInt(b[a].remaining)}</div></div></div><div class="btn-div"> <div class="info-container"> <div class="info-text"># of Parties:</div><div show="parties" class="info-text">${b[a].customers.length}</div></div><a show="button" ct="${a}" href="#" class="show-btn w-button">View Parties</a> </div></div></div>`;$('[show="list"]').append(r)}searchResults=b,$('[show="heading"]').text("Shows On "+h+" "+i+", "+j),$('[party="heading"]').text("Select A Show")}else console.log("Unknown Error")}function searchProducts(a){$.ajax({async:!1,crossDomain:!0,url:"https://app.ecwid.com/api/v3/"+storeId+"/products?keyword="+a,method:"GET",headers:{Accept:"application/json",Authorization:"Bearer "+key}}).done(function(a){productSearchResults=a,checkPastProducts()})}function searchOrders(a){$.ajax({async:!1,crossDomain:!0,url:"https://app.ecwid.com/api/v3/"+storeId+"/orders?productId="+a,method:"GET",headers:{Accept:"application/json",Authorization:"Bearer "+key}}).done(function(c){var f=0,g=[];for(let b=0;b<c.items.length;b++){let h={party:n=void 0!==c.items[b].shippingPerson?c.items[b].shippingPerson.name:"No Name",orderNum:c.items[b].id};for(let e=0;e<c.items[b].items.length;e++)parseInt(c.items[b].items[e].productId)==parseInt(a)&&(h.tickets=c.items[b].items[e].quantity,f+=parseInt(c.items[b].items[e].quantity));g.push(h)}searchCustomers=g,searchCounter=f})}function checkPastProducts(){if(0==checked){var b=[];dateChecker=productSearchResults;for(let a=0;a<dateChecker.items.length;a++){var e,f=parseInt(dateChecker.items[a].sku.replace(/\s/g,"").split("-")[1].split(":")[1].replace(/([a-zA-Z])/g,""));e="PM"===dateChecker.items[a].sku.replace(/\s/g,"").split("-")[1].split(":")[1].replace(/[0-9]/g,"").toUpperCase()?parseInt(dateChecker.items[a].sku.replace(/\s/g,"").split("-")[1].split(":")[0])+12:parseInt(dateChecker.items[a].sku.replace(/\s/g,"").split("-")[1].split(":")[0]),parseInt(dateChecker.items[a].sku.replace(/\s/g,"").split(",")[0].replace(/\D/g,""))<d.getDate()?!0===dateChecker.items[a].enabled&&b.push(dateChecker.items[a].id):parseInt(dateChecker.items[a].sku.replace(/\s/g,"").split(",")[0].replace(/\D/g,""))==d.getDate()&&e<d.getHours()&&f<d.getMinutes()&& !0===dateChecker.items[a].enabled&&b.push(dateChecker.items[a].id)}for(let c=0;c<b.length;c++)hideProduct(b[c].toString());checked=1}else 1==checked?console.log("check run"):console.log("error checking")}function hideProduct(a){$.ajax({async:!0,crossDomain:!0,url:"https://app.ecwid.com/api/v3/"+storeId+"/products/"+a,method:"PUT",data:"{enabled: false}",headers:{Accept:"application/json",Authorization:"Bearer "+key,"Content-Type":"application/json"}}).done(function(a){console.log(a)})}$("#select-month").change(function(){if(["January","March","May","July","August","October","December"].includes($("#select-month").val())){$("#select-day").empty(),$("#custom-search").removeClass("grey");for(let b=0;b<31;b++){var a=`<option value="${b+1}">${b+1}</option>`;$("#select-day").append(a)}}else if(["April","June","September","November"].includes($("#select-month").val())){$("#select-day").empty(),$("#custom-search").removeClass("grey");for(let c=0;c<30;c++){var a=`<option value="${c+1}">${c+1}</option>`;$("#select-day").append(a)}}else if(["February"].includes($("#select-month").val())){$("#select-day").empty(),$("#custom-search").removeClass("grey");for(let e=0;e<29;e++){var a=`<option value="${e+1}">${e+1}</option>`;$("#select-day").append(a)}}else{$("#custom-search").addClass("grey"),$("#select-day").empty();var a='<option value="Select Day">Select Day</option>';$("#select-day").append(a)}}),$("#custom-search").click(function(){if("Select Day"===$("#select-day").val())console.log("No proper date");else{var a=$("#select-month").val().toUpperCase(),b=$("#select-day").val().toString();$("#select-month").val(""),$("#select-month").trigger("change"),$('[show="list"]').empty(),$('[party="list"]').empty(),$('[show="heading"]').text("Searching..."),$('[party="heading"]').text("Searching..."),setTimeout(function(){searchProducts(a),showSearch(productSearchResults,a,b,d.getFullYear().toString())},100)}}),$(function(){$('[show="list"]').empty(),$('[party="list"]').empty(),$('[show="heading"]').text("Searching..."),$('[party="heading"]').text(""),setTimeout(function(){searchProducts(todayMonth),showSearch(productSearchResults,todayMonth.toUpperCase(),d.getDate().toString(),d.getFullYear().toString())},100)}),$("body").on("click",'[show="button"]',function(f){$('[party="list"]').empty();var c=$(this).attr("ct"),a=searchResults[c].customers;a.sort(function(a,b){return b.tickets-a.tickets});for(let b=0;b<a.length;b++){var e=`<div id="party-div" class="party-div w-node-_8d0f08c4-d1dd-5322-5862-e203fbf256bc-ee1bbea5"> <div class="party-heading-container"> <h2 class="party-heading">Party:&nbsp;</h2> <h2 party="name" class="party-heading">${a[b].party}</h2> </div><div class="party-info"> <div party="quant" class="party-size">${a[b].tickets}</div><div class="party-order-div"> <div class="num-text">Order #:&nbsp;</div><div party="order" class="party-order">${a[b].orderNum}</div></div></div></div>`;$('[party="list"]').append(e)}$('[party="heading"]').text(searchResults[c].name+" Parties")})
